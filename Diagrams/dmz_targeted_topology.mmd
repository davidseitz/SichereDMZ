graph LR
    %% ----- STYLING -----
    classDef router fill:#f9f,stroke:#333,stroke-width:2px
    classDef security fill:#ff9,stroke:#333,stroke-width:2px
    classDef server fill:#ccf,stroke:#333,stroke-width:2px
    classDef siem fill:#fcc,stroke:#333,stroke-width:2px
    classDef net fill:#cfc,stroke:#333,stroke-width:2px

    %% ----- ZONEN (Subgraphs) -----
    subgraph " "
        direction TB
        subgraph "INTERNET (Extern)"
            INET["Internet<br>(Attacker / Nutzer)"]
        end
        
        subgraph "DMZ (10.10.1.0/24)"
            direction TB
            
            subgraph "Proaktiver Pfad (Inline)"
                direction LR
                WAF["WAF / Reverse Proxy<br>(10.10.1.10)<br>LISTEN: 80, 443"] --> WEB["Webserver<br>(10.10.1.100)<br>LISTEN: 80"]
            end
            
            subgraph "Detektierender Pfad (Passiv)"
                IDS["IDS (Suricata)<br>(10.10.1.20)<br>Spiegelt Traffic"]
            end
        end

        subgraph "INTERNE NETZE (Intern)"
            direction TB
            CLIENT["Client-Netz<br>(10.10.2.0/24)"]
            SIEM["SIEM (Wazuh)<br>(10.10.3.0/24)"]
        end
    end

    %% ----- ROUTER / FIREWALLS (Die Grenzen) -----
    R_EDGE["router_edge<br>(Firewall 1)"]
    R_INT["router_int<br>(Firewall 2)"]

    %% ----- DATENFLÃœSSE -----
    
    %% 1. Externer Zugriff (Proaktiv)
    INET -- "1. Anfrage (80/443)" --> R_EDGE
    R_EDGE -- "2. Forward (Nur 80/443)" --> WAF
    
    %% 2. Interner Zugriff
    CLIENT -- "Interner Nutzer" --> R_INT
    R_INT -- "Interner Zugriff (80/443)" --> WAF

    %% 3. Traffic-Spiegelung (Detektiv)
    R_EDGE -. "1a. Spiegelung" .-> IDS
    
    %% 4. Logging (Detektiv)
    WEB -. "Logs (TCP 1514)" .-> R_INT
    WAF -. "Logs (TCP 1514)" .-> R_INT
    IDS -. "Alerts (TCP 1514)" .-> R_INT
    R_EDGE -. "Logs (Syslog 514)" .-> R_INT
    R_INT -. "Logs -> SIEM" .-> SIEM

    %% ----- CSS Klassen Zuweisung -----
    class R_EDGE,R_INT router
    class WAF,IDS security
    class WEB server
    class SIEM siem
    class INET,CLIENT net