# -------------------------------------------------------------------
# PYTHON WEBAPP LOG PIPELINE
# -------------------------------------------------------------------

[INPUT]
    Name             tail
    Path             /var/log/webapp.log
    Tag              application.webapp
    Read_from_Head   True

# 1. PARSE
# Extract fields using the python_webapp Regex defined in parsers.conf
[FILTER]
    Name             parser
    Match            application.webapp
    Key_Name         log
    Parser           python_webapp
    Reserve_Data     On

# 2. CLEAN
# Filter out repetitive noise messages like repeated log initializations
[FILTER]
    Name             grep
    Match            application.webapp
    Exclude          message ^Application logging initialized and outputting to

# 3. OUTPUT
[OUTPUT]
    Name             loki
    Match            application.webapp
    Host             10.10.30.2
    Port             3100
    
    # Label by Level (INFO, ERROR, etc.) and Module (app) for easy filtering
    Labels           job=webapp, host=webserver_alpine, level=$level, module=$module
    
    Line_Format      json
