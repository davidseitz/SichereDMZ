[PARSER]
    Name        aide_json_parser
    Format      json
    Time_Key    start_time
    Time_Format %Y-%m-%d %H:%M:%S %z

[PARSER]
    Name        coredns_regex
    Format      regex
    Regex       ^\[(?<level>[^\]]+)\]\s+(?<remote_ip>[^:]+):(?<remote_port>\d+)\s+-\s+(?<id>\d+)\s+"(?<type>\S+)\s+(?<class>\S+)\s+(?<name>\S+)\s+(?<proto>\S+)\s+(?<req_size>\d+)\s+(?<do>\S+)\s+(?<bufsize>\d+)"\s+(?<rcode>\S+)\s+(?<flags>\S+)\s+(?<resp_size>\d+)\s+(?<duration>[\d\.]+)s$
    # No Time_Key available in the log line itself, so we use ingestion time.
    Types       id:integer remote_port:integer req_size:integer resp_size:integer duration:float

# 1. SSH ACCEPTED CONNECTION PARSER (SUCCESS)
[PARSER]
    Name          ssh_accepted
    Format        regex
    Regex         ^Accepted\s+(?<auth_method>\S+)\s+for\s+(?<user>\S+)\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+)\s+(?<protocol>\S+):\s+(?<key_type>\S+)\s+(?<fingerprint>\S+)$
    Types         remote_port:integer

# 2. SSH FAILED AUTHENTICATION PARSER (POST-PREAUTH FAILURES)
# For failures like "Failed publickey for admin..."
[PARSER]
    Name          ssh_failed_auth
    Format        regex
    Regex         ^Failed\s+(?<auth_method>\S+)\s+for\s+(?:invalid\s+user\s+)?(?<user>\S+)\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+)\s+(?<protocol>\S+)(?::\s*(?<details>.*))?$
    Types         remote_port:integer

# 3. SSH INVALID USER (PREAUTH FAILURE)
# Example: Invalid user admin1 from 10.10.20.2 port 35246
[PARSER]
    Name          ssh_invalid_user
    Format        regex
    Regex         ^Invalid\s+user\s+(?<user>\S+)\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+)$
    Types         remote_port:integer

# 4. SSH CONNECTION CLOSED (PREAUTH) - **UPDATED** to capture both failure types
# New Example: Connection closed by authenticating user admin 10.10.20.2 port 53990 [preauth]
[PARSER]
    Name          ssh_closed_preauth
    Format        regex
    # Regex updated to capture both "invalid user" and "authenticating user" forms of pre-auth closure.
    Regex         ^Connection\s+closed\s+by\s+(?:invalid\s+user|authenticating\s+user)\s+(?<user>\S+)\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+)\s+\[preauth\]$
    Types         remote_port:integer

# 5. SSH DISCONNECT MESSAGE PARSER (POST-AUTH DISCONNECTS)
# Example: Received disconnect from 10.10.20.2 port 59624:11: disconnected by user
[PARSER]
    Name          ssh_disconnect
    Format        regex
    Regex         ^Received\s+disconnect\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+):(?<reason_code>\d+):\s+(?<reason_message>.*)$
    Types         remote_port:integer reason_code:integer
