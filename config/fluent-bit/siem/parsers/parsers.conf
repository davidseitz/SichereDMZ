[PARSER]
    Name        aide_json_parser
    Format      json
    Time_Key    start_time
    Time_Format %Y-%m-%d %H:%M:%S %z

# 1. SSH ACCEPTED CONNECTION PARSER
# Focuses on extracting key details from successful authentication attempts.
# Example: Accepted publickey for admin from 10.10.20.2 port 59624 ssh2: ED25519 SHA256:aGYbcIHtTbgqHWNpOFpj7XPlUYH8pAqz7coznqbqHCE
[PARSER]
    Name          ssh_accepted
    Format        regex
    # Captures: Auth Method, User, Remote IP, Remote Port, Protocol, Key Type, Fingerprint
    Regex         ^Accepted\s+(?<auth_method>\S+)\s+for\s+(?<user>\S+)\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+)\s+(?<protocol>\S+):\s+(?<key_type>\S+)\s+(?<fingerprint>\S+)$
    Types         remote_port:integer

# 2. SSH FAILED AUTHENTICATION PARSER (UPDATED)
# Captures all failed login attempts (password or publickey), whether the user was valid or invalid.
# This ensures you catch all attempts, especially publickey failures for valid users.
# Examples: 
# - Failed publickey for admin from 10.10.20.2 port 45000 ssh2
# - Failed password for invalid user fred from 192.168.1.1 port 45000 ssh2
[PARSER]
    Name          ssh_failed_auth
    Format        regex
    # Note: Handles 'invalid user' being present or absent, and captures 'publickey' or 'password' failures.
    Regex         ^Failed\s+(?<auth_method>\S+)\s+for\s+(?:invalid\s+user\s+)?(?<user>\S+)\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+)\s+(?<protocol>\S+)(?::\s*(?<details>.*))?$
    Types         remote_port:integer

# 3. SSH DISCONNECT MESSAGE PARSER
# Captures disconnects initiated by the user or the server.
# Example: Received disconnect from 10.10.20.2 port 59624:11: disconnected by user
[PARSER]
    Name          ssh_disconnect
    Format        regex
    # Captures: Remote IP, Remote Port, Reason Code, Reason Message
    Regex         ^Received\s+disconnect\s+from\s+(?<remote_ip>\S+)\s+port\s+(?<remote_port>\d+):(?<reason_code>\d+):\s+(?<reason_message>.*)$
    Types         remote_port:integer reason_code:integer
