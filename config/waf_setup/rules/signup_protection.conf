# Initialize IP collection
SecAction \
 "id:100001,phase:1,pass,nolog,initcol:ip=%{REMOTE_ADDR},expirevar:ip.signup_burst=60"

# Check if IP is already banned
SecRule IP:SIGNUP_BLOCK "@eq 1" \
 "id:100002,phase:1,deny,log,msg:'Client blocked due to signup flood'"

# Count POST requests to /signup
SecRule REQUEST_URI "@streq /signup" \
 "id:100003,phase:2,chain,pass,nolog,t:none"
    SecRule REQUEST_METHOD "@streq POST" \
        "t:none,setvar:ip.signup_burst=+1"

# If count > 5 in 60 seconds, BLOCK and set a 600s (10 min) ban flag
SecRule IP:SIGNUP_BURST "@gt 5" \
 "id:100004,phase:2,deny,log,msg:'Potential Signup Flood Detected',setvar:ip.signup_block=1,expirevar:ip.signup_block=600"