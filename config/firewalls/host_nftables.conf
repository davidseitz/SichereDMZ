# This is the static nftables configuration for a Host (FWH) in Blacklist Mode.
# It is designed to block outgoing traffic over the management interface (ethmgmt).

flush ruleset

table inet filter {

    # Chains & policies (Blacklist style: default policy is ACCEPT)
    chain INPUT {
        type filter hook input priority 0; policy accept;

        # 1. Allow established/related traffic (Good hygiene)
        ct state established,related accept

        # 2. Allow local traffic (loopback)
        iif lo accept

        # 3. Allow all incoming traffic on the management network (Hosts may *receive*)
        iifname "ethmgmt" accept
    }

    chain OUTPUT {
        type filter hook output priority 0; policy accept;

        # 1. Allow established/related traffic (Good hygiene)
        ct state established,related accept

        # 2. Allow local traffic (loopback)
        oif lo accept

        # 3. Prevent sending data over the management network (Hosts may *not send*)
        # This rule will be hit before the final 'accept' policy.
        oifname "ethmgmt" log prefix "FWH_MGMT_DENIED: " drop
    }

    chain FORWARD {
        # FORWARD chain is typically empty on a simple host that doesn't route traffic
        type filter hook forward priority 0; policy accept;

        # 1. Allow established/related traffic (Good hygiene)
        ct state established,related accept
    }
}