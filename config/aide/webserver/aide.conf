# AIDE Configuration for Alpine Linux
# tailored for Containerized Environments

# --- 1. Settings & Environment ---
@@x_include_setenv PATH /bin:/usr/bin:/sbin:/usr/sbin

# Database Paths
database_in=file:/var/lib/aide/aide.db.gz
database_out=file:/var/lib/aide/aide.db.new
database_new=file:/var/lib/aide/aide.db.new
gzip_dbout=yes

# Output Settings (JSON to Stdout for easy logging/parsing)
report_format = json
report_url = stdout

# --- 2. Macros / Rule Definitions ---
Checksums = sha512
OwnerMode = p+u+g+ftype
Size = s+b
InodeData = OwnerMode+n+i+Size+l+X
StaticFile = m+c+Checksums

# Full: Checks permissions, inode, user, group, size, time, and checksum
Full = InodeData+StaticFile

# --- 3. CUSTOM TARGETS (Your Specific Requirements) ---

# Monitor the Application Directory
# recurses through the whole folder structure
/app Full

# Monitor resolv.conf
# Using 'Full' because you confirmed it is mounted and static.
# If this changes, it implies a serious configuration shift or breach.
/etc/resolv.conf Full

# Monitor SSH Configuration
/etc/ssh/sshd_config Full

# Exclude SSH Host Keys from monitoring?
# If your keys are persistent (mounted volume), change these lines to 'Full'.
# If they are generated every time the container starts (common), keep them ignored ('!')
!/etc/ssh/ssh_host_rsa_key
!/etc/ssh/ssh_host_rsa_key.pub
!/etc/ssh/ssh_host_ed25519_key
!/etc/ssh/ssh_host_ed25519_key.pub
!/etc/ssh/ssh_host_ecdsa_key
!/etc/ssh/ssh_host_ecdsa_key.pub

# --- 4. ALPINE SYSTEM BASELINE ---

# Busybox & System Binaries
/bin        Full
/sbin       Full
/usr/bin    Full
/usr/sbin   Full

# Libraries (Alpine/Musl)
/lib        Full
/usr/lib    Full
# Alpine sometimes uses /usr/local/lib
/usr/local/lib Full

# Boot (Kernel/Initramfs - usually minimal in containers but good to watch)
/boot       Full

# Root Home (scripts often live here)
/root       Full

# General Configuration
/etc        Full

# --- 5. EXCLUSIONS & NOISE REDUCTION ---

# Exclude the AIDE database being written
!/var/lib/aide/aide.db.new
!/var/lib/aide/aide.db.new.gz

# Watch the active DB to ensure no tampering
/var/lib/aide/aide.db.gz StaticFile

# Hosts files (Docker manages these dynamically)
!/etc/hosts
!/etc/hostname
!/etc/mtab

# Logs - Ignore content changes, only track if file attributes change strangely
# or exclude entirely to save CPU
!/var/log

# Runtime / Volatile Directories
!/var/cache
!/var/run
!/run
!/tmp
!/var/tmp
!/proc
!/sys
!/dev
!/media
!/mnt

# Docker/Container specific noise
!/execute_test_cases.sh
